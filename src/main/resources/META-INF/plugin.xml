<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <version>1.0.1</version>

    <id>com.github.audichuang.clipcode</id>
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.vcs</depends>
    <depends>Git4Idea</depends>

    <name>ClipCode</name>
    <vendor email="audiapplication880208@gmail.com" url="https://github.com/audichuang">audichuang</vendor>

    <!-- https://plugins.jetbrains.com/docs/marketplace/best-practices-for-listing.html -->
    <description><![CDATA[
    <p><b>ClipCode</b> - The ultimate code sharing tool for developers. Quickly copy file contents with smart formatting, perfect for sharing with AI assistants like ChatGPT, Claude, and Gemini.</p>
    <h2>Key Features:</h2>
    <ul>
        <li>Copy multiple files/directories with customizable headers</li>
        <li>Git integration: Copy from staging area, changes view, and commit history</li>
        <li>Paste and restore: Recreate files from copied content</li>
        <li>Advanced filtering: Include/exclude paths and patterns</li>
        <li>Smart statistics: File count, lines, words, and token estimates</li>
    </ul>
    ]]>
    </description>

    <change-notes><![CDATA[
    <h2>Version 1.0.1</h2>
    <ul>
      <li><b>Improved notification transparency</b>: Now shows skipped file count when files exceed size limit (e.g., "14 files copied (1 skipped: size exceeded)")</li>
      <li><b>Fix Git Log copy</b>: Historical files, duplicate prevention, and better notifications</li>
      <li><b>Fix UNTRACKED files</b>: Untracked files now properly copied from Commit window</li>
      <li><b>IDE compatibility</b>: Removed upper version limit for better compatibility</li>
      <li><b>OOM prevention</b>: Added file size pre-check to prevent out-of-memory errors</li>
    </ul>

    <h2>Version 1.0.0 - Initial Release</h2>
    <p><b>ClipCode</b> - The ultimate code sharing tool for AI-assisted development!</p>

    <h3>Core Features</h3>
    <ul>
      <li><b>Smart Copy</b>: Copy single or multiple files/directories with customizable headers</li>
      <li><b>Copy All Open Tabs</b>: Quickly copy content from all open editor tabs</li>
      <li><b>Statistics</b>: Shows file count, lines, words, and estimated token count</li>
    </ul>

    <h3>Git Integration</h3>
    <ul>
      <li>Copy from Git Staging Area (staged/unstaged files)</li>
      <li>Copy from Git Changes view with change type labels ([NEW], [MODIFIED], [DELETED], [MOVED])</li>
      <li>Copy from Git Log/History window</li>
    </ul>

    <h3>Paste & Restore</h3>
    <ul>
      <li>Restore files from clipboard content (Ctrl+Shift+Alt+V)</li>
      <li>Automatic directory structure creation</li>
      <li>Smart parsing of Git change labels</li>
      <li>Overwrite protection with confirmation dialog</li>
    </ul>

    <h3>Advanced Filtering</h3>
    <ul>
      <li>PATH filters: Include/exclude specific directories</li>
      <li>PATTERN filters: Wildcards for file names (e.g., *.java, test_*)</li>
      <li>Individual rule enable/disable</li>
      <li>File size and count limits</li>
    </ul>

    <h3>Customization</h3>
    <ul>
      <li>Configurable header format with $FILE_PATH placeholder</li>
      <li>Pre/post text wrappers</li>
      <li>Notification preferences</li>
    </ul>

    <p><b>Compatibility:</b> IntelliJ IDEA 2024.3 - 2025.2 and all JetBrains IDEs</p>
    ]]>
    </change-notes>

    <extensions defaultExtensionNs="com.intellij">
        <notificationGroup id="ClipCode" displayType="BALLOON" isLogByDefault="true" />

        <projectConfigurable
            id="ClipCodeConfigurable"
            displayName="ClipCode Settings"
            instance="com.github.audichuang.clipcode.CopyFileContentConfigurable"/>
    </extensions>
    <actions>
        <!-- For general IntelliJ IDEs -->
        <action id="ClipCodeCopyAction"
                class="com.github.audichuang.clipcode.CopyFileContentAction"
                text="ClipCode: Copy to Clipboard"
                description="Copy folder and file content to the clipboard.">
            <add-to-group group-id="CutCopyPasteGroup" anchor="after" relative-to-action="CopyPaths"/>
        </action>
        <action id="ClipCodeCopyAllTabsAction"
                class="com.github.audichuang.clipcode.CopyAllOpenTabsAction"
                text="ClipCode: Copy All Open Tabs"
                description="Copy the content of all open editor tabs to the clipboard.">
            <add-to-group group-id="EditorTabPopupMenu" anchor="after" relative-to-action="CopyPaths"/>
        </action>

        <!-- For Rider -->
        <action id="ClipCodeCopyActionRider"
                class="com.github.audichuang.clipcode.CopyFileContentAction"
                text="ClipCode: Copy to Clipboard"
                description="Copy folder and file content to the clipboard.">
            <add-to-group group-id="CopyReferencePopupGroup" anchor="after" relative-to-action="CopyPaths"/>
        </action>

        <!-- Paste and Restore Files Action -->
        <action id="ClipCodePasteAction"
                class="com.github.audichuang.clipcode.PasteAndRestoreFilesAction"
                text="ClipCode: Paste and Restore Files"
                description="Parse clipboard content and restore files to the project.">
            <add-to-group group-id="CutCopyPasteGroup" anchor="after" relative-to-action="ClipCodeCopyAction"/>
            <add-to-group group-id="ProjectViewPopupMenu" anchor="after" relative-to-action="$Paste"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift alt V"/>
        </action>

        <!-- Git Changes Copy Action - Copy full file content (not diff patch) -->
        <action id="ClipCodeGitCopyAction"
                class="com.github.audichuang.clipcode.CopyGitFilesContentAction"
                text="ClipCode: Copy Full Source"
                description="Copy the complete file content of selected changes with change type labels ([NEW], [MODIFIED], [DELETED]).">
            <!-- Local Changes window (Commit tool window) -->
            <add-to-group group-id="ChangesViewPopupMenu" anchor="after" relative-to-action="CopyPaths"/>
            <!-- Git Log window (Version Control history) -->
            <add-to-group group-id="Vcs.Log.ContextMenu" anchor="after" relative-to-action="CopyPaths"/>
            <!-- Git Log - Changed Files Browser -->
            <add-to-group group-id="Vcs.Log.ChangesBrowser.Popup" anchor="after" relative-to-action="CopyPaths"/>
            <!-- Git Staging Area - Unstaged files -->
            <add-to-group group-id="Git.Stage.Local.File.Menu" anchor="last"/>
            <!-- Git Staging Area - Staged files -->
            <add-to-group group-id="Git.Stage.Index.File.Menu" anchor="last"/>
            <!-- Git Staging Area - Tree menu -->
            <add-to-group group-id="Git.Stage.Tree.Menu" anchor="last"/>
        </action>
    </actions>
</idea-plugin>
