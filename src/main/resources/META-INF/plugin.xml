<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <version>1.0.1</version>

    <id>com.github.mwguerra.copyfilecontent</id>
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.vcs</depends>

    <name>Copy File Content</name>
    <vendor email="mwguerra@gmail.com" url="https://mwguerra.com">Marcelo W. Guerra</vendor>

    <!-- https://plugins.jetbrains.com/docs/marketplace/best-practices-for-listing.html -->
    <description><![CDATA[
    <p>The "Copy File Content" plugin enhances your workflow by allowing you to quickly copy the contents of selected files and directories to the clipboard, formatted according to customizable settings.</p>
    <h2>This plugin is useful for:</h2>
    <ul>
        <li>Developers who frequently need to share their code via chat applications.</li>
        <li>Developers who need to copy their code to build context for LLM apps like ChatGPT, Gemini, or Sapiens Chat.</li>
    </ul>
    <h2>Main features:</h2>
    <ul>
        <li>Copy the content of multiple files or directories to the clipboard.</li>
        <li>Customizable text structure, including pre-text, file header text, and post-text.</li>
        <li>Configurable file copying constraints (default is 30 files) to prevent memory issues with larger folders.</li>
        <li>Optional file extension filters to specify which files should be copied.</li>
        <li>Information on the copied items, including the number of files copied, total lines, total words, and an estimate of tokens (considering words and punctuation).</li>
    </ul>
    ]]>
    </description>

    <change-notes><![CDATA[
    <h2>Version 1.0.1 - Bug Fix Release</h2>
    <h3>üêõ Critical Bug Fixes</h3>
    <ul>
      <li><b>Git Staging Area Support:</b> Fixed "Copy File Content (Full Source)" not appearing in Git Staging Area (Staged/Unstaged sections)</li>
      <li><b>Multiple Change Labels Handling:</b> Fixed incorrect parsing when multiple change type labels appear in file paths (e.g., [MODIFIED] [NEW])</li>
      <li><b>Deleted File Detection:</b> Fixed false positive detection when [DELETED] appears in directory names</li>
      <li><b>No-Space Edge Case:</b> Fixed label stripping when no whitespace follows change type labels</li>
    </ul>
    <h3>‚ú® Improvements</h3>
    <ul>
      <li>Optimized regex pattern compilation for better performance when processing many files</li>
      <li>Enhanced path validation to prevent invalid characters including square brackets</li>
      <li>Added comprehensive debug logging for label stripping operations</li>
      <li>Improved documentation with detailed edge case handling examples</li>
    </ul>
    <h3>üîß Technical Changes</h3>
    <ul>
      <li>Integrated CommitWorkflowUi API for consistent Git UI support across Modal/Non-Modal/Staging modes</li>
      <li>Pre-compiled regex patterns moved to companion object for performance</li>
      <li>Added bracket validation in path normalization to catch un-stripped labels</li>
    </ul>
    <br/>
    <h2>Version 1.0.0 - Major Release</h2>
    <h3>üéâ New Features</h3>
    <ul>
      <li><b>Paste and Restore Files:</b> New reverse operation to restore files from clipboard content (Ctrl+Shift+Alt+V)</li>
      <li><b>Advanced Filtering System:</b> Include/Exclude paths and file patterns with IDE file chooser integration</li>
      <li><b>Pattern Matching:</b> Support for wildcards and regex in file name filters</li>
      <li><b>Configurable File Size Limit:</b> Adjustable maximum file size for processing (default 500KB)</li>
    </ul>
    <h3>‚ú® Improvements</h3>
    <ul>
      <li>Upgraded to IntelliJ Platform 2024.3+ with Gradle Plugin 2.x</li>
      <li>Enhanced UI with platform-standard components and theme support</li>
      <li>Improved settings persistence and reliability</li>
      <li>Better memory management with pre-allocated buffers</li>
      <li>Multi-row selection support in filter table</li>
    </ul>
    <h3>üêõ Bug Fixes</h3>
    <ul>
      <li>Fixed filter rules not persisting after IDE restart</li>
      <li>Fixed potential null pointer exceptions</li>
      <li>Improved error handling and user feedback</li>
    </ul>
    <h3>üöÄ Platform Support</h3>
    <ul>
      <li>Supports IntelliJ IDEA 2024.3 to 2025.2</li>
      <li>Kotlin 2.0.21 for better performance</li>
    </ul>
    ]]>
    </change-notes>

    <extensions defaultExtensionNs="com.intellij">
        <notificationGroup id="Copy File Content" displayType="BALLOON" isLogByDefault="true" />

        <projectConfigurable
            id="CopyFileContentConfigurable"
            displayName="Copy File Content Settings"
            instance="com.github.mwguerra.copyfilecontent.CopyFileContentConfigurable"/>
    </extensions>
    <actions>
        <!-- For general IntelliJ IDEs -->
        <action id="CopyFileContentContentsAction"
                class="com.github.mwguerra.copyfilecontent.CopyFileContentAction"
                text="Copy File Content to Clipboard"
                description="Copy folder and file content to the clipboard.">
            <add-to-group group-id="CutCopyPasteGroup" anchor="after" relative-to-action="CopyPaths"/>
        </action>
        <action id="CopyAllOpenTabsAction"
                class="com.github.mwguerra.copyfilecontent.CopyAllOpenTabsAction"
                text="Copy All Open Tabs Content to Clipboard"
                description="Copy the content of all open editor tabs to the clipboard.">
            <add-to-group group-id="EditorTabPopupMenu" anchor="after" relative-to-action="CopyPaths"/>
        </action>

        <!-- For Rider -->
        <action id="CopyFileContentContentsActionRider"
                class="com.github.mwguerra.copyfilecontent.CopyFileContentAction"
                text="Copy File Content to Clipboard"
                description="Copy folder and file content to the clipboard.">
            <add-to-group group-id="CopyReferencePopupGroup" anchor="after" relative-to-action="CopyPaths"/>
        </action>
        
        <!-- Paste and Restore Files Action -->
        <action id="PasteAndRestoreFilesAction"
                class="com.github.mwguerra.copyfilecontent.PasteAndRestoreFilesAction"
                text="Paste and Restore Files from Clipboard"
                description="Parse clipboard content and restore files to the project.">
            <add-to-group group-id="CutCopyPasteGroup" anchor="after" relative-to-action="CopyFileContentContentsAction"/>
            <add-to-group group-id="ProjectViewPopupMenu" anchor="after" relative-to-action="$Paste"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift alt V"/>
        </action>

        <!-- Git Changes Copy Action - Copy full file content (not diff patch) -->
        <action id="CopyGitFilesContentAction"
                class="com.github.mwguerra.copyfilecontent.CopyGitFilesContentAction"
                text="Copy File Content (Full Source)"
                description="Copy the complete file content of selected changes with change type labels ([NEW], [MODIFIED], [DELETED]). Different from 'Copy as Patch' which only shows diff.">
            <!-- Local Changes window (Commit tool window) -->
            <add-to-group group-id="ChangesViewPopupMenu" anchor="after" relative-to-action="CopyPaths"/>
            <!-- Git Log window (Version Control history) -->
            <add-to-group group-id="Vcs.Log.ContextMenu" anchor="after" relative-to-action="CopyPaths"/>
        </action>
    </actions>
</idea-plugin>
